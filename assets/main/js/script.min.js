document.addEventListener("DOMContentLoaded",()=>{gsap.registerPlugin(ScrollTrigger);let e=new Lenis;e.on("scroll",ScrollTrigger.update),gsap.ticker.add(t=>{e.raf(1e3*t)}),gsap.ticker.lagSmoothing(0);let a={gravity:{x:0,y:1},restitution:.5,friction:.15,frictionAir:.02,density:.002,wallThickness:200,mouseStiffness:.6},s,l,d,c=[],h=null;function g(t,e,i){return Math.max(e,Math.min(i,t))}function i(t){console.log("Initializing physics..."),(s=Matter.Engine.create()).gravity.x=a.gravity.x,s.gravity.y=a.gravity.y,s.constraintIterations=10,s.positionIterations=20,s.velocityIterations=16,s.timing.timeScale=1;let r=t.getBoundingClientRect(),e=(console.log("Container dimensions:",r.width,"x",r.height),a.wallThickness);var i=[Matter.Bodies.rectangle(r.width/2,r.height+e/2,r.width+2*e,e,{isStatic:!0}),Matter.Bodies.rectangle(-e/2,r.height/2,e,r.height+2*e,{isStatic:!0}),Matter.Bodies.rectangle(r.width+e/2,r.height/2,e,r.height+2*e,{isStatic:!0})],i=(Matter.World.add(s.world,i),t.querySelectorAll(".object")),i=(console.log("Found",i.length,"objects"),i.forEach((t,e)=>{var i=t.getBoundingClientRect(),n=Math.random()*(r.width-i.width)+i.width/2,e=-500-200*e,o=(Math.random()-.5)*Math.PI,n=Matter.Bodies.rectangle(n,e,i.width,i.height,{restitution:a.restitution,friction:a.friction,frictionAir:a.frictionAir,density:a.density});Matter.Body.setAngle(n,o),c.push({body:n,element:t,width:i.width,height:i.height}),Matter.World.add(s.world,n)}),console.log("Added",c.length,"physics bodies"),setTimeout(()=>{h=Matter.Bodies.rectangle(r.width/2,-e/2,r.width+2*e,e,{isStatic:!0}),Matter.World.add(s.world,h),console.log("Top wall added")},5e3),Matter.Mouse.create(t));i.element.removeEventListener("mousewheel",i.mousewheel),i.element.removeEventListener("DOMMouseScroll",i.mousewheel),(d=Matter.MouseConstraint.create(s,{mouse:i,constraint:{stiffness:a.mouseStiffness,render:{visible:!1}}})).mouse.element.oncontextmenu=()=>!1;let o=null,n=null;Matter.Events.on(d,"startdrag",function(t){(o=t.body)&&(n=o.inertia,Matter.Body.setInertia(o,1/0),Matter.Body.setVelocity(o,{x:0,y:0}),Matter.Body.setAngularVelocity(o,0))}),Matter.Events.on(d,"enddrag",function(t){o&&(Matter.Body.setInertia(o,n||1),o=null,n=null)}),Matter.Events.on(s,"beforeUpdate",function(){var t,e,i,n;o&&(n=c.find(t=>t.body===o))&&(t=n.width/2,e=r.width-n.width/2,i=n.height/2,n=r.height-n.height/2,Matter.Body.setPosition(o,{x:g(o.position.x,t,e),y:g(o.position.y,i,n)}),Matter.Body.setVelocity(o,{x:g(o.velocity.x,-20,20),y:g(o.velocity.y,-20,20)}))}),t.addEventListener("mouseleave",t=>{d&&d.constraint&&(d.constraint.bodyB=null,d.constraint.pointB=null)}),document.addEventListener("mouseup",t=>{d&&d.constraint&&(d.constraint.bodyB=null,d.constraint.pointB=null)}),Matter.World.add(s.world,d),l=Matter.Runner.create(),Matter.Runner.run(l,s),function t(){c.forEach(({body:t,element:e,width:i,height:n})=>{i=g(t.position.x-i/2,0,r.width-i),n=g(t.position.y-n/2,3*-n,r.height-n),e.style.left=i+"px",e.style.top=n+"px",e.style.transform=`rotate(${t.angle}rad)`}),requestAnimationFrame(t)}()}setTimeout(()=>{var t=document.querySelector(".object-container");t?(console.log("Starting physics simulation..."),i(t)):console.error("Container not found!")},100)});